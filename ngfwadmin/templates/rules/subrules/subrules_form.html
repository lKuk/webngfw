{% load static %}

    <!-- [Модальное окно правила] start -->
    {% if action == 'insert' %}
        <div class="modal fade" id="subruleInsert" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
    {% else %}
        <div class="modal fade" id="subruleUpdate_{{ s.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
    {% endif %}
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <form action="" method="post">
                {% csrf_token %}
                    <div class="modal-header">
                        {% if action == 'insert' %}
                            <h5>Создать новое подправило</h5>
                        {% else %}
                            <h5>Редактировать подправило</h5>
                        {% endif %}
                    </div>
                    <div class="modal-body">

                        <input name="id" value="{{ s.id }}" type="hidden">
                        <!-- Atomic -->
                        <div class="form-group">
                            <label>Атомарное правило:</label>
                            <select name="atomic" class="form-control" id="ar_id" onchange="ar_id_onchange()">
                                {% for key, value in atomic.items %}
                                    <option value="{{ value }}">{{ value.description }}</option>
                                {% endfor %}
                                <option selected="selected" value=""></option>
                            </select>
                        </div>
                        <!-- List -->
                        <div class="form-group" id="dev_list" hidden="hidden">
                            <label>Список:</label>
                            <select name="list" class="form-control">
                                {% for list in lists %}
                                    <option value="{{ list }}">{{ list.ftype }} - {{ list.description }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- IP -->
                        <div class="form-group" id="dev_ip" hidden="hidden">
                            <label>IP адрес:</label>
                            <input name="ip_address" type="text" class="form-control">
                        </div>
                        <!-- MAC -->
                        <div class="form-group" id="dev_mac" hidden="hidden">
                            <label>MAC адрес:</label>
                            <input name="mac_address" type="text" class="form-control">
                        </div>
                        <!-- PORT -->
                        <div class="form-group"  id="dev_port" hidden="hidden">
                            <label>Порт:</label>
                            <input name="port" type="text" value="80" class="form-control">
                        </div>
                        <!-- PROPONAME -->
                        <div class="form-group" id="dev_proto" hidden="hidden">
                            <label>Протокол:</label>
                            <select name="protocol" class="form-control">
                                {% for value in protocol %}
                                    <option>{{ value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- SERVICENAME -->
                        <div class="form-group" id="dev_service" hidden="hidden">
                            <label>Сервис:</label>
                            <select name="service" class="form-control">
                                {% for value in service %}
                                    <option>{{ value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- GATEGORYNAME -->
                        <div class="form-group" id="dev_category" hidden="hidden">
                            <label>Категория:</label>
                            <select name="category" class="form-control">
                                <option></option>
                            </select>
                        </div>
                        <!-- invert -->
                        <div class="form-group" id="dev_category">
                            <label>Инвертация:</label>
                            <select name="invert" class="form-control">
                                <option value="0" selected="selected">Не инвертировано</option>
                                <option value="1">Инвертировано</option>
                            </select>
                        </div>

                    </div>
                    <div class="modal-footer">
                        {% if action == 'insert' %}
                            <button type="submit" class="btn btn-primary" name="btnInsert" style="width: 120px;">Создать</button>
                        {% else %}
                            <button type="submit" name="btnDelete" class="btn btn-icon btn-outline-danger mr-auto" title="Удалить подправило" onclick="return confirm('Выполнить удаление правила?');">
                                <i class="feather icon-trash-2"></i>
                            </button>
                            <button type="submit" name="btnUpdate" class="btn btn-primary" style="width: 120px;">Сохранить</button>
                        {% endif %}
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" style="width: 120px;">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- [Модальное окно правила] end -->


    <script>
        function ar_id_onchange() {
            // определить контролы
            ar_id = document.getElementById("ar_id");
            dev_ip = document.getElementById("dev_ip");
            dev_mac = document.getElementById("dev_mac");
            dev_list = document.getElementById("dev_list");
            dev_port = document.getElementById("dev_port");
            dev_proto = document.getElementById("dev_proto");
            dev_service = document.getElementById("dev_service");
            dev_gategory = document.getElementById("dev_category");

            // скрыть все контролы
            dev_ip.hidden = true;
            dev_mac.hidden = true;
            dev_list.hidden = true;
            dev_port.hidden = true;
            dev_proto.hidden = true;
            dev_service.hidden = true;
            dev_gategory.hidden = true;

            // получить json
            let str = ar_id.value.replaceAll("'", "\"");
            json = JSON.parse(str);
            // получить тип файла
            file_type = json['file_type'];
            // получить тип аргумента
            arg_type = json['arg_type'];

            // настроить видимость
            if(arg_type === 'IP')
                dev_ip.hidden = false;
            if(arg_type === 'MAC')
                dev_mac.hidden = false;
            if(arg_type === 'PORT')
                dev_port.hidden = false;
            if(arg_type === 'PROTNAME')
                dev_proto.hidden = false;
            if(arg_type === 'CATEGNAME')
                dev_gategory.hidden = false;
            if(arg_type === 'SERVICENAME')
                dev_service.hidden = false;

            // видимость списков
            if(arg_type === 'file') {
                dev_list.hidden = false
                // сюда вставить фильтрацию списков;
            }
            //alert( 'file_type: ' + file_type + '    arg_type: ' + arg_type );
        }
    </script>

