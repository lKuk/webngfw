{% extends "base.html" %}
{% load static %}

{# Стили #}
{% block style %}
{% endblock style %}

{# Скрипты #}
{% block script %}
    <!-- Валидации -->
    <script>
        // Скрипт валидации
        function Validate(elementId, validLiId, validDivId, format, text) {
            // Получить контролы валидации
            const element = document.getElementById(elementId);
            const validLi = document.getElementById(validLiId);
            const validDiv = document.getElementById(validDivId);
            // Выполнить проверку содержимого
            validDiv.hidden = true;
            if (element.value.match(format))
                return true;
            // Отобразить ошибку
            validDiv.hidden = false;
            validDiv.classList.add('text-danger');
            validDiv.classList.remove("invalid-feedback")
            validLi.textContent =  text;
            return false;
        }

        // Валидация в зависимости от формата
        function ValidateAll(event) {
            // определить формат валидации
            const formatIp = /(^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$)/;

            // выполнить валидацию
            let res4 = Validate("ip_end", "validLi_ip_end", "validDiv_ip_end", formatIp, "Введите действительный IPv4 или IPv6 адрес.");
            let res3 = Validate("ip_start", "validLi_ip_start", "validDiv_ip_start", formatIp, "Введите действительный IPv4 или IPv6 адрес.");

            // отменить отправку формы на сервер
            if (res1 === false
                || res2 === false
                || res3 === false
                || res4 === false) {
                event.preventDefault()
                event.stopPropagation()
            }
        }

        // Выполнить при загрузке страницы
        window.addEventListener('load', () => {
            // Подписаться на событие валидации формы
            const routeEditForm = document.getElementById("subnetEditForm");
            routeEditForm.addEventListener("submit", ValidateAll);
        });
    </script>
{% endblock script %}

{# Заголовок #}
{% block header %}
    <li class="m-l-5 m-t-5">
        <h4>
            <i class="m-r-15 feather icon-wifi"></i>Настройки подсетей DHCP
        </h4>
    </li>
    <ul class="breadcrumb my-0 py-0 m-l-30 p-l-50 bg-transparent">
        <li class="breadcrumb-item"><a href="{% url 'protocol_dhcp_subnet' %}">Настройки подсетей</a></li>
        <li class="breadcrumb-item"><a href="#">Новое</a></li>
    </ul>
{% endblock header %}

{# Содержимое #}
{% block content %}

    <div class="page-wrapper">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="page-header-title">
                            <h5>Изменить диапазон подсети DHCP</h5>
                        </div>
                    </div>
                    <form action="" method="post" id="subnetEditForm">
                    {% csrf_token %}
                    <div class="card-body">
                        <div class="row">
                            <div class="col">
                                <!-- Кнопки -->
                                <button type="submit" name="btnInsert" class="btn btn-primary shadow-2" style="width: 180px">Сохранить</button>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <!-- Параметры -->
                            <div class="col-md-6 col-xl-4">
                                <!-- Порт VLAN-->
                                <div class="form-group">
                                    <label>Порт: {{ port }}</label>
                                    <br>
                                    <label>VLAN: {{ vlan }}</label>
                                </div>
                                <!-- IP-адрес start -->
                                <div class="form-group">
                                    <label for="ip_start">Начало диапазона IP-адресов:</label>
                                    <input id="ip_start" name="ip_start" type="text" class="form-control" required value="{{ ip_start }}">
                                    <div class="invalid-feedback" id="validDiv_ip_start">
                                        <ul>
                                            <li id="validLi_ip_start"></li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- IP-адрес end -->
                                <div class="form-group">
                                    <label for="ip_end">Окончание диапазона IP-адресов:</label>
                                    <input id="ip_end" name="ip_end" type="text" class="form-control" required value="{{ ip_end }}">
                                    <div class="invalid-feedback" id="validDiv_ip_end">
                                        <ul>
                                            <li id="validLi_ip_end"></li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- Включено -->
                                <div class="form-group">
                                    <label for="status">Включено:</label>
                                    <select id="status" name="status" class="form-control" required>
                                        <option value="True" selected>Включено</option>
                                        <option value="udp">Выключено</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}