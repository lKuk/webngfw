{% extends "base.html" %}
{% load static %}

{# Стили #}
{% block style %}
{% endblock style %}

{# Скрипты #}
{% block script %}
    <!-- Валидации -->
    <script>
        // Скрипт валидации
        function Validate(elementId, validLiId, validDivId, format, text) {
            // Получить контролы валидации
            const element = document.getElementById(elementId);
            const validLi = document.getElementById(validLiId);
            const validDiv = document.getElementById(validDivId);
            // Выполнить проверку содержимого
            validDiv.hidden = true;
            if (element.value.match(format))
                return true;
            // Отобразить ошибку
            validDiv.hidden = false;
            validDiv.classList.add('text-danger');
            validDiv.classList.remove("invalid-feedback")
            validLi.textContent =  text;
            return false;
        }

        // Валидация в зависимости от формата
        function ValidateAll(event) {
            // определить формат валидации
            const formatIp = /(^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$)/;
            const formatPort = /^((6553[0-5])|(655[0-2][0-9])|(65[0-4][0-9]{2})|(6[0-4][0-9]{3})|([1-5][0-9]{4})|([0-5]{0,5})|([0-9]{1,4}))$/;

            // выполнить валидацию
            let res1 = Validate("port_lan", "validLi_port_lan", "validDiv_port_lan", formatPort, "Введите целое число от 0 до 65535.");
            let res2 = Validate("port_wan", "validLi_port_wan", "validDiv_port_wan", formatPort, "Введите целое число от 0 до 65535.");
            let res3 = Validate("ip_wan", "validLi_ip_wan", "validDiv_ip_wan", formatIp, "Введите действительный IPv4 или IPv6 адрес.");
            let res4 = Validate("ip_lan", "validLi_ip_lan", "validDiv_ip_lan", formatIp, "Введите действительный IPv4 или IPv6 адрес.");

            // отменить отправку формы на сервер
            if (res1 === false
                || res2 === false
                || res3 === false
                || res4 === false) {
                event.preventDefault()
                event.stopPropagation()
            }
        }

        // Выполнить при загрузке страницы
        window.addEventListener('load', () => {
            // Подписаться на событие валидации формы
            const routeEditForm = document.getElementById("natEditForm");
            routeEditForm.addEventListener("submit", ValidateAll);
        });
    </script>
{% endblock script %}

{# Заголовок #}
{% block header %}
    <li class="m-l-5 m-t-5">
        <h4>
            <i class="m-r-15 feather icon-wifi"></i>Создание нового преобразование сетевых адресов NAT
        </h4>
    </li>
    <ul class="breadcrumb my-0 py-0 m-l-30 p-l-50 bg-transparent">
        <li class="breadcrumb-item"><a href="{% url 'protocol_nat' %}">Конфигурация NAT</a></li>
        <li class="breadcrumb-item"><a href="#">Новый</a></li>
    </ul>
{% endblock header %}

{# Содержимое #}
{% block content %}

    <div class="page-wrapper">
        <div class="card">
            <div class="card-header">
                <div class="page-header-title">
                    <h5>Конфигурация NAT</h5>
                </div>
            </div>
            <form action="" method="post" id="natEditForm">
            {% csrf_token %}
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <!-- Кнопки -->
                            <button type="submit" name="btnInsert" class="btn btn-primary shadow-2" style="width: 160px">Создать</button>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <!-- Параметры -->
                        <div class="col-md-6 col-xl-4">
                            <!-- Протокол -->
                            <div class="form-group">
                                <label for="protocol">Протокол:</label>
                                <select id="protocol" name="protocol" class="form-control" required>
                                    <option value="tcp">TCP</option>
                                    <option value="udp">UDP</option>
                                </select>
                            </div>
                            <!-- IP-адрес LAN -->
                            <div class="form-group">
                                <label for="ip_lan">IP-адрес LAN:</label>
                                <input id="ip_lan" name="ip_lan" type="text" class="form-control" required>
                                <div class="invalid-feedback" id="validDiv_ip_lan">
                                    <ul>
                                        <li id="validLi_ip_lan"></li>
                                    </ul>
                                </div>
                            </div>
                            <!-- Порт LAN -->
                            <div class="form-group">
                                <label for="port_lan">Порт LAN:</label>
                                <input id="port_lan" name="port_lan" type="text" class="form-control" required>
                                <div class="invalid-feedback" id="validDiv_port_lan">
                                    <ul>
                                        <li id="validLi_port_lan"></li>
                                    </ul>
                                </div>
                            </div>

                            <!-- IP-адрес WAN -->
                            <div class="form-group">
                                <label for="ip_wan">IP-адрес WAN:</label>
                                <input id="ip_wan" name="ip_wan" type="text" class="form-control" required>
                                <div class="invalid-feedback" id="validDiv_ip_wan">
                                    <ul>
                                        <li id="validLi_ip_wan"></li>
                                    </ul>
                                </div>
                            </div>
                            <!-- Порт WAN -->
                            <div class="form-group">
                                <label for="port_wan">Порт WAN:</label>
                                <input id="port_wan" name="port_wan" type="text" class="form-control" required>
                                <div class="invalid-feedback" id="validDiv_port_wan">
                                    <ul>
                                        <li id="validLi_port_wan"></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

{% endblock content %}