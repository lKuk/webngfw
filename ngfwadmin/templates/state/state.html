{% extends "base.html" %}
{% load static %}

{# Стили #}
{% block style %}
{% endblock style %}

{# Скрипты #}
{% block script %}
    <script src="{% static 'main/plugins/jquery/js/jquery.min.js' %}"></script>
    <script>
        // Запрос данных Ajax
        function RequestAjax() {
            // Параметры
            const param = {
                type: 'GET',
                dataType: 'json',
                url: '{% url 'state' %}?ajax',
                success: Update
            }
            // Выполнить запрос
            $.ajax(param);
            // Запустить повторно по таймеру
            setTimeout(RequestAjax, 1000);
        }

        // Обновление страницы
        function Update(response) {
            // Время работы
            if('uptime' in response) {
                let uptime = response.uptime;
                let m = uptime.mins;
                let s = uptime.secs;
                let d = uptime.days;
                let h = uptime.hours;
                let value = `Время работы: ${d}д. ${h}ч.  ${m}мин. ${s}сек.`;
                let currentTime = document.getElementById('currentTime');
                currentTime.textContent = value;
            }
            // Память
            if('ram' in response) {
                let ram = response.ram;
                let used = ram.used;
                let total = ram.total;
                let percent = ram.percent;
                let value = `Память: проценты (${percent}), всего (${total}), используется (${used})`;
                let currentRam = document.getElementById('currentRam');
                currentRam.textContent = value;
            }

            // Диски
            if('disk' in response) {
                let disk = response.disk;
                let used = disk.used;
                let total = disk.total;
                let percent = disk.percent;
                let value = `Диски: проценты (${percent}), всего (${total}), используется (${used})`
                let currentDisk = document.getElementById('currentDisk')
                currentDisk.textContent = value;
            }

            // Процессоры
            if('lcores' in response) {
                let lcores = response.lcores;
                let cores = JSON.stringify(lcores);
                let value = `Ядра: ${cores}`
                let currentCores = document.getElementById('currentCores')
                currentCores.textContent = value;
            }
        }

        // Запуск при загрузке страницы
        window.addEventListener('load', () => {
            RequestAjax();
        });
    </script>


{% endblock script %}

{# Заголовок #}
{% block header %}
    <li class="m-l-5 m-t-5">
        <h4>
            <i class="m-r-15 feather icon-home"></i>Система
        </h4>
    </li>
{% endblock header %}

{# Содержимое #}
{% block content %}

    <div class="page-wrapper">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="page-header-title">
                            <h5>Параметры системы</h5>
                        </div>
                        <ul class="breadcrumb m-t-10">
                            <li class="breadcrumb-item"><a href="{% url 'state' %}"><i
                                    class="feather icon-home p-r-5"></i>Система</a></li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <p class="text-dark">Версия ПО: {{ version.version }}</p>
                        <p class="text-dark">Серийный номер: {{ serial.serial_number }}</p>
                        <p class="text-dark">Статус системы: {{ status.main_status }} - {{ status.sub_status }}</p>
                        <p class="text-dark">Время старта: {{ uptime.start_time }}
                        <p class="text-dark" id="currentTime">Время работы: {{ uptime.days }}д. {{ uptime.hours }}ч. {{ uptime.mins }}мин. {{ uptime.secs }}сек.</p>

                        <p class="text-dark" id="currentRam">Память: {{ ram }}</p>
                        <p class="text-dark" id="currentDisk">Диски: {{ disk }}</p>
                        <p class="text-dark" id="currentCores">Ядра процессора: {{ lcores }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}